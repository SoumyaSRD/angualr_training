<div class="topic-container" id="top">
  <!-- Header Section -->
  <header class="topic-header">
    <div class="header-content">
      <h1 class="topic-title">{{ title }}</h1>

      @if (tags && tags.length > 0) {
        <nav class="tags-navigation" aria-label="Topic tags">
          <mat-chip-set aria-label="Topic tags">
            @for (tag of tags; track tag) {
              <mat-chip
                class="topic-tag"
                [matTooltip]="'Jump to ' + tag + ' section'"
                (click)="scrollToSection(getTagLink(tag) || '')"
                [class.clickable]="getTagLink(tag)"
              >
                <mat-icon>tag</mat-icon>
                {{ tag }}
              </mat-chip>
            }
          </mat-chip-set>
        </nav>
      }
    </div>
  </header>

  <mat-divider></mat-divider>

  <!-- Introduction Section -->
  <section class="introduction-section">
    <ng-content></ng-content>
  </section>

  <!-- Detailed Sections -->
  @if (sections && sections.length > 0) {
    <section class="detailed-sections">
      <div class="section-header">
        <mat-icon class="section-icon">menu_book</mat-icon>
        <h2>Detailed Explanation</h2>
      </div>

      @for (section of sections; track section.heading; let idx = $index) {
        <article class="section-card-wrapper" [id]="getSectionId(section, idx)">
          <mat-card class="section-card" appearance="outlined">
            <mat-card-header>
              <div class="section-number" mat-card-avatar>
                {{ idx + 1 }}
              </div>
              <mat-card-title>{{ section.heading }}</mat-card-title>
            </mat-card-header>

            <mat-card-content>
              @if (section.content) {
                <p class="section-content">{{ section.content }}</p>
              }

              @if (section.list && section.list.length > 0) {
                <ul class="section-list">
                  @for (item of section.list; track item) {
                    <li [innerHTML]="item"></li>
                  }
                </ul>
              }

              @if (section.additionalExplanation) {
                <div class="additional-note">
                  <mat-icon>info</mat-icon>
                  <p>{{ section.additionalExplanation }}</p>
                </div>
              }
            </mat-card-content>
          </mat-card>
        </article>
      }
    </section>
  }

  <!-- Code Examples -->
  @if (codeExamples && codeExamples.length > 0) {
    <section class="code-examples-section">
      <div class="section-header">
        <mat-icon class="section-icon">code</mat-icon>
        <h2>Code Examples</h2>
      </div>

      @for (example of codeExamples; track example.title; let idx = $index) {
        <mat-card class="code-card" appearance="outlined">
          <mat-card-header>
            <div class="code-number" mat-card-avatar>
              <mat-icon>code</mat-icon>
            </div>
            <mat-card-title>{{ example.title }}</mat-card-title>
            @if (example.description) {
              <mat-card-subtitle>{{ example.description }}</mat-card-subtitle>
            }
          </mat-card-header>

          <mat-card-content>
            <div class="code-toolbar">
              <span class="language-badge">
                <mat-icon>code_blocks</mat-icon>
                {{ example.language || "text" }}
              </span>
              <button
                mat-icon-button
                class="copy-button"
                matTooltip="Copy code"
                (click)="copyCode(example.code)"
              >
                <mat-icon>content_copy</mat-icon>
              </button>
            </div>
            <pre class="code-block"><code>{{ example.code }}</code></pre>
          </mat-card-content>
        </mat-card>
      }
    </section>
  }

  <!-- Best Practices -->
  @if (bestPractices && bestPractices.length > 0) {
    <section class="best-practices-section">
      <mat-card class="info-card best-practices-card" appearance="outlined">
        <mat-card-header>
          <div class="card-icon success-icon" mat-card-avatar>
            <mat-icon>verified</mat-icon>
          </div>
          <mat-card-title>Best Practices</mat-card-title>
          <mat-card-subtitle>Industry-recommended approaches</mat-card-subtitle>
        </mat-card-header>

        <mat-card-content>
          <ul class="practices-list">
            @for (practice of bestPractices; track practice) {
              <li>
                <mat-icon class="practice-icon">check_circle</mat-icon>
                <span>{{ practice }}</span>
              </li>
            }
          </ul>
        </mat-card-content>
      </mat-card>
    </section>
  }

  <!-- Key Takeaways -->
  @if (keyPoints && keyPoints.length > 0) {
    <section class="key-points-section">
      <mat-card class="info-card key-points-card" appearance="outlined">
        <mat-card-header>
          <div class="card-icon primary-icon" mat-card-avatar>
            <mat-icon>lightbulb</mat-icon>
          </div>
          <mat-card-title>Key Takeaways</mat-card-title>
          <mat-card-subtitle>Essential points to remember</mat-card-subtitle>
        </mat-card-header>

        <mat-card-content>
          <ul class="takeaways-list">
            @for (point of keyPoints; track point) {
              <li>
                <mat-icon class="takeaway-icon">arrow_right</mat-icon>
                <span>{{ point }}</span>
              </li>
            }
          </ul>
        </mat-card-content>
      </mat-card>
    </section>
  }

  <!-- Back to Top Button -->
  <button
    mat-fab
    class="back-to-top"
    matTooltip="Back to top"
    (click)="scrollToSection('top')"
  >
    <mat-icon>arrow_upward</mat-icon>
  </button>
</div>
