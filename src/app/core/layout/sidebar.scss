// =============================================================================
// SIDEBAR COMPONENT — Glassmorphism SCSS
// Consumes tokens from the glass-design-system.css (:root / [data-theme])
// =============================================================================

// ─── Mixins ──────────────────────────────────────────────────────────────────

/// Base glass surface — backdrop + border + inner highlight
@mixin glass-surface($blur: var(--glass-blur), $bg: var(--glass-bg)) {
  background: $bg;
  backdrop-filter: blur($blur) saturate(1.8);
  -webkit-backdrop-filter: blur($blur) saturate(1.8);
  border: 1px solid var(--glass-border);
  box-shadow: var(--shadow-md), var(--glass-inner-shadow);

  // Top-edge highlight — the detail that makes it feel like real glass
  &::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: linear-gradient(
      160deg,
      rgba(255, 255, 255, 0.18) 0%,
      rgba(255, 255, 255, 0.04) 50%,
      transparent 100%
    );
    pointer-events: none;
  }
}

/// Accent-tinted hover fill
@mixin accent-fill($opacity: 0.10) {
  background: color-mix(in srgb, var(--accent-primary) #{$opacity * 100%}, transparent);
  color: var(--accent-primary);
}

/// Gradient text clip
@mixin gradient-text {
  background: var(--accent-gradient);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/// Active pill — gradient fill + glow
@mixin active-pill {
  background: var(--accent-gradient);
  color: var(--text-on-accent, #fff);
  box-shadow: 0 4px 20px var(--accent-glow), var(--glass-inner-shadow);
}

/// Smooth transition shorthand
@mixin transition($props: all, $dur: var(--duration-base), $ease: var(--ease-smooth)) {
  transition: $props $dur $ease;
}

// ─── Animations ──────────────────────────────────────────────────────────────

@keyframes slideDown {
  from { opacity: 0; transform: translateY(-10px) scaleY(0.96); }
  to   { opacity: 1; transform: translateY(0) scaleY(1); }
}

@keyframes tooltipIn {
  from { opacity: 0; transform: scale(0.94) translateX(-8px); }
  to   { opacity: 1; transform: scale(1)    translateX(0); }
}

@keyframes pulseGlow {
  0%, 100% { box-shadow: 0 4px 14px var(--accent-glow); }
  50%       { box-shadow: 0 4px 28px var(--accent-glow), 0 0 40px var(--accent-glow); }
}

// =============================================================================
// HOST
// =============================================================================

:host {
  display: contents;
  font-family: var(--font-body, 'DM Sans', sans-serif);
}

// =============================================================================
// SIDEBAR SHELL
// =============================================================================

.sidebar {
  position: fixed;
  left: 0;
  top: 0;
  height: 100vh;
  width: 260px;
  display: flex;
  flex-direction: column;
  z-index: 1030;
  overflow: hidden; // clip the ::before gradient
  @include transition(width, var(--duration-slow), var(--ease-smooth));

  // Glass surface (positioned relative for ::before)
  position: fixed; // re-declare to allow ::before layering
  @include glass-surface(var(--glass-blur));

  // Right edge — stronger border with accent bleed
  border-right: 1px solid var(--glass-border-strong);
  border-top: none;
  border-bottom: none;
  border-left: none;
  border-radius: 0 var(--radius-xl) var(--radius-xl) 0;

  // Subtle vertical accent stripe
  &::after {
    content: '';
    position: absolute;
    top: 10%;
    bottom: 10%;
    right: -1px;
    width: 2px;
    background: var(--accent-gradient);
    border-radius: var(--radius-full);
    opacity: 0.35;
    pointer-events: none;
  }

  // ── Collapsed state ────────────────────────────────────────────────────────
  &.collapsed {
    width: 72px;
    border-radius: 0 var(--radius-lg) var(--radius-lg) 0;

    .nav-label,
    .logo-text,
    .arrow-icon {
      opacity: 0;
      width: 0;
      pointer-events: none;
      overflow: hidden;
    }
  }

  // ── Mobile open state ──────────────────────────────────────────────────────
  &.mobile-open {
    transform: translateX(0) !important;
    box-shadow: var(--shadow-xl), 0 0 60px var(--accent-glow);
  }
}

// =============================================================================
// LOGO SECTION
// =============================================================================

.sidebar-logo {
  height: 70px;
  display: flex;
  align-items: center;
  padding: 0 18px;
  border-bottom: 1px solid var(--glass-border);
  flex-shrink: 0;
  position: relative;

  // Bottom edge glow line
  &::after {
    content: '';
    position: absolute;
    bottom: -1px;
    left: 20%;
    right: 20%;
    height: 1px;
    background: var(--accent-gradient);
    opacity: 0.5;
    border-radius: var(--radius-full);
  }
}

.logo-link {
  display: flex;
  align-items: center;
  gap: 12px;
  text-decoration: none;
  color: inherit;
  outline: none;
}

.logo-icon {
  width: 40px;
  height: 40px;
  background: var(--accent-gradient);
  border-radius: var(--radius-md);
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 1.25rem;
  flex-shrink: 0;
  box-shadow: 0 4px 16px var(--accent-glow);
  animation: pulseGlow 3.5s var(--ease-smooth) infinite;
  @include transition(transform);

  .logo-link:hover & { transform: scale(1.08) rotate(-4deg); }
}

.logo-text {
  font-family: var(--font-display, 'Syne', sans-serif);
  font-size: 1.1875rem;
  font-weight: 800;
  letter-spacing: -0.02em;
  white-space: nowrap;
  @include gradient-text;
  @include transition((opacity, width));
}

// =============================================================================
// MAIN NAV
// =============================================================================

.sidebar-nav {
  flex: 1;
  overflow-y: auto;
  overflow-x: hidden;
  padding: 14px 10px;
  scrollbar-width: thin;
  scrollbar-color: var(--glass-border-strong) transparent;

  &::-webkit-scrollbar { width: 3px; }
  &::-webkit-scrollbar-track { background: transparent; }
  &::-webkit-scrollbar-thumb {
    background: var(--glass-border-strong);
    border-radius: var(--radius-full);
  }
  &::-webkit-scrollbar-thumb:hover { background: var(--accent-primary); }
}

// =============================================================================
// NAV LINK — shared base for all clickable nav rows
// =============================================================================

.nav-link {
  display: flex;
  align-items: center;
  gap: 11px;
  padding: 10px 14px;
  border-radius: var(--radius-md);
  color: var(--text-muted);
  text-decoration: none;
  cursor: pointer;
  border: 1px solid transparent;
  background: transparent;
  width: 100%;
  font-size: 0.9rem;
  font-weight: 500;
  font-family: var(--font-body, inherit);
  position: relative;
  overflow: hidden;
  @include transition(all, var(--duration-fast), var(--ease-smooth));
  margin-bottom: 2px;

  // Shimmer sweep on hover
  &::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(
      105deg,
      transparent 30%,
      rgba(255, 255, 255, 0.12) 50%,
      transparent 70%
    );
    transform: translateX(-100%);
    @include transition(transform, 450ms, var(--ease-smooth));
    pointer-events: none;
    border-radius: inherit;
  }

  &:hover {
    background: color-mix(in srgb, var(--accent-primary) 9%, transparent);
    color: var(--accent-primary);
    border-color: color-mix(in srgb, var(--accent-primary) 14%, transparent);

    &::after { transform: translateX(100%); }

    .nav-icon {
      background: color-mix(in srgb, var(--accent-primary) 14%, transparent);
      color: var(--accent-primary);
      transform: scale(1.06);
    }
  }

  // Active pill — full gradient fill
  &.active {
    @include active-pill;

    .nav-icon {
      background: rgba(255, 255, 255, 0.22);
      color: inherit;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.3);
    }
  }
}

// ── Nav Icon Bubble ──────────────────────────────────────────────────────────

.nav-icon {
  width: 34px;
  height: 34px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: var(--radius-sm);
  font-size: 1.0625rem;
  flex-shrink: 0;
  background: transparent;
  @include transition(all, var(--duration-fast), var(--ease-spring));
}

// ── Nav Label ────────────────────────────────────────────────────────────────

.nav-label {
  white-space: nowrap;
  overflow: hidden;
  flex: 1;
  text-align: left;
  @include transition((opacity, width));
}

// =============================================================================
// NAV GROUP + TOGGLE
// =============================================================================

.nav-group {
  margin-bottom: 2px;
}

.nav-group-toggle {
  justify-content: flex-start;
}

.arrow-icon {
  margin-left: auto;
  font-size: 0.6875rem;
  opacity: 0.5;
  flex-shrink: 0;
  @include transition(transform, var(--duration-base), var(--ease-spring));
}

.nav-group-toggle.expanded {
  color: var(--accent-primary);
  background: color-mix(in srgb, var(--accent-primary) 7%, transparent);

  .arrow-icon { transform: rotate(90deg); opacity: 0.9; }
  .nav-icon {
    background: color-mix(in srgb, var(--accent-primary) 14%, transparent);
    color: var(--accent-primary);
  }
}

// =============================================================================
// SUBMENU
// =============================================================================

.submenu {
  margin: 3px 0 6px 44px;
  padding-left: 14px;
  border-left: 1.5px solid color-mix(in srgb, var(--accent-primary) 30%, transparent);
  animation: slideDown var(--duration-base) var(--ease-smooth) both;
  transform-origin: top;
}

.submenu-link {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 7px 10px;
  border-radius: var(--radius-sm);
  color: var(--text-muted);
  text-decoration: none;
  font-size: 0.85rem;
  position: relative;
  @include transition(all, var(--duration-fast), var(--ease-smooth));

  &:hover {
    color: var(--accent-primary);
    background: color-mix(in srgb, var(--accent-primary) 7%, transparent);
    padding-left: 14px; // indent nudge on hover

    .submenu-dot {
      background: var(--accent-primary);
      box-shadow: 0 0 8px var(--accent-glow);
      transform: scale(1.4);
    }
  }

  &.active {
    color: var(--accent-primary);
    font-weight: 600;

    .submenu-dot {
      background: var(--accent-primary);
      box-shadow: 0 0 10px var(--accent-glow);
    }
  }
}

.submenu-dot {
  width: 5px;
  height: 5px;
  border-radius: 50%;
  background: var(--glass-border-strong);
  flex-shrink: 0;
  @include transition(all, var(--duration-fast), var(--ease-spring));
}

// =============================================================================
// FOOTER
// =============================================================================

.sidebar-footer {
  padding: 10px;
  border-top: 1px solid var(--glass-border);
  flex-shrink: 0;
  position: relative;

  // Top glow line
  &::before {
    content: '';
    position: absolute;
    top: -1px;
    left: 20%;
    right: 20%;
    height: 1px;
    background: var(--accent-gradient);
    opacity: 0.35;
    border-radius: var(--radius-full);
  }

  .nav-link {
    color: var(--text-muted);
    font-size: 0.8125rem;
    font-weight: 600;
    letter-spacing: 0.02em;

    &:hover { color: var(--accent-secondary); }
  }
}

// =============================================================================
// TOOLTIP (collapsed state flyout)
// =============================================================================

.nav-tooltip {
  position: fixed;
  left: 82px;
  z-index: 1060;
  min-width: 210px;
  border-radius: var(--radius-lg);
  overflow: hidden;
  animation: tooltipIn var(--duration-base) var(--ease-spring) both;

  @include glass-surface(var(--glass-blur-heavy), var(--glass-bg-hover));
  box-shadow: var(--shadow-xl), 0 0 24px var(--accent-glow);
}

.tooltip-header {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 12px 16px 10px;
  font-family: var(--font-display, 'Syne', sans-serif);
  font-size: 0.8125rem;
  font-weight: 700;
  letter-spacing: 0.04em;
  color: var(--text-primary);
  border-bottom: 1px solid var(--glass-border);

  i {
    font-size: 1rem;
    @include gradient-text;
    // gradient-text uses text-fill; fallback for icons
    background: var(--accent-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
}

.tooltip-content {
  padding: 8px;
}

.tooltip-item {
  display: block;
  padding: 8px 12px;
  border-radius: var(--radius-sm);
  color: var(--text-secondary);
  text-decoration: none;
  font-size: 0.85rem;
  @include transition(all, var(--duration-fast), var(--ease-smooth));

  &:hover {
    background: color-mix(in srgb, var(--accent-primary) 10%, transparent);
    color: var(--accent-primary);
    padding-left: 16px;
  }
}

// =============================================================================
// MOBILE OVERLAY
// =============================================================================

.sidebar-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.35);
  backdrop-filter: blur(6px) saturate(0.8);
  -webkit-backdrop-filter: blur(6px) saturate(0.8);
  z-index: 1025;
  animation: fade-in var(--duration-base) var(--ease-smooth) both;
}

@keyframes fade-in {
  from { opacity: 0; }
  to   { opacity: 1; }
}

// =============================================================================
// RESPONSIVE — MOBILE
// =============================================================================

@media (max-width: 991.98px) {
  .sidebar {
    transform: translateX(-100%);
    width: 280px !important;
    border-radius: 0 var(--radius-xl) var(--radius-xl) 0;
    @include transition(transform, var(--duration-slow), var(--ease-spring));

    // In mobile the sidebar is always "expanded" visually
    &.collapsed {
      .nav-label,
      .logo-text {
        opacity: 1;
        width: auto;
        pointer-events: auto;
        overflow: visible;
      }

      .arrow-icon {
        opacity: 0.5;
        width: auto;
      }
    }
  }
}

// =============================================================================
// REDUCED MOTION
// =============================================================================

@media (prefers-reduced-motion: reduce) {
  .logo-icon { animation: none; }

  .nav-link::after,
  .submenu,
  .nav-tooltip { animation: none; transition: none; }
}