// ============================================================================
// GLASS UI DESIGN SYSTEM v4.0 — UTILITY CLASSES
// Cinematic · Spatial · Luminous · Premium
//
// NEW IN v4.0:
// ▸ Elevation utilities       — .elev-0 → .elev-5 (3D depth stack)
// ▸ Edge glow utilities       — .edge-glow-{sm|md|lg}
// ▸ Aura utilities            — .aura-{subtle|normal|intense}
// ▸ Glass surface variants    — .glass-refract · .glass-prism · .glass-deep
// ▸ Magnetic lift utilities   — .lift-{sm|md|lg} · .lift-press
// ▸ Light scatter             — .scatter-light · .scatter-dark
// ▸ Cinematic type scale      — .text-{xs→4xl} (fluid clamp-based)
// ▸ Spatial labels            — .text-spatial · .text-cinematic
// ▸ Gradient text             — .text-gradient · .text-gradient-accent
// ▸ Contrast helpers          — .contrast-boost · .contrast-boost-dark
// ▸ Depth light utilities     — .depth-light · .depth-light-deep
// ▸ Mesh background           — .bg-mesh · .bg-mesh-fixed
// ▸ Noise grain               — .noise-grain
// ▸ Prism border              — .border-prism
// ▸ Animation utilities       — .animate-{entrance|float|pulse-glow|shimmer|spin}
// ▸ Stagger helpers           — .stagger-{1→8}
// ▸ Responsive show/hide      — .show-{xs→xl} · .hide-{xs→xl}
// ▸ Aspect ratio              — .aspect-{square|video|wide|portrait}
// ▸ Isolation / z-index       — .isolate · .z-{0→50|auto}
// ▸ Pointer event helpers     — .events-none · .events-auto
// ▸ Selection helpers         — .select-none · .select-all · .select-text
// ============================================================================

@use 'sass:map';
@use 'sass:math';
@use 'variables' as *;
@use 'mixins' as *;


// ============================================================================
// SPACING UTILITIES  (preserved architecture, unchanged)
// ============================================================================

@each $key, $value in $spacing {
  .m-#{$key}  { margin: $value; }
  .mt-#{$key} { margin-top: $value; }
  .mr-#{$key} { margin-right: $value; }
  .mb-#{$key} { margin-bottom: $value; }
  .ml-#{$key} { margin-left: $value; }
  .mx-#{$key} { margin-left: $value; margin-right: $value; }
  .my-#{$key} { margin-top: $value; margin-bottom: $value; }

  .p-#{$key}  { padding: $value; }
  .pt-#{$key} { padding-top: $value; }
  .pr-#{$key} { padding-right: $value; }
  .pb-#{$key} { padding-bottom: $value; }
  .pl-#{$key} { padding-left: $value; }
  .px-#{$key} { padding-left: $value; padding-right: $value; }
  .py-#{$key} { padding-top: $value; padding-bottom: $value; }
}

.m-auto  { margin: auto; }
.mx-auto { margin-left: auto; margin-right: auto; }
.my-auto { margin-top: auto; margin-bottom: auto; }


// ============================================================================
// DISPLAY UTILITIES
// ============================================================================

.d-none         { display: none; }
.d-block        { display: block; }
.d-inline       { display: inline; }
.d-inline-block { display: inline-block; }
.d-flex         { display: flex; }
.d-inline-flex  { display: inline-flex; }
.d-grid         { display: grid; }
.d-contents     { display: contents; }


// ============================================================================
// FLEX UTILITIES
// ============================================================================

.flex-row     { flex-direction: row; }
.flex-column  { flex-direction: column; }
.flex-wrap    { flex-wrap: wrap; }
.flex-nowrap  { flex-wrap: nowrap; }
.flex-1       { flex: 1; }
.flex-auto    { flex: auto; }
.flex-none    { flex: none; }
.flex-shrink-0 { flex-shrink: 0; }
.flex-grow-1   { flex-grow: 1; }

.justify-start   { justify-content: flex-start; }
.justify-end     { justify-content: flex-end; }
.justify-center  { justify-content: center; }
.justify-between { justify-content: space-between; }
.justify-around  { justify-content: space-around; }
.justify-evenly  { justify-content: space-evenly; }

.align-start   { align-items: flex-start; }
.align-end     { align-items: flex-end; }
.align-center  { align-items: center; }
.align-stretch { align-items: stretch; }
.align-baseline { align-items: baseline; }

.gap-xs   { gap: var(--space-xs); }
.gap-sm   { gap: var(--space-sm); }
.gap-md   { gap: var(--space-md); }
.gap-lg   { gap: var(--space-lg); }
.gap-xl   { gap: var(--space-xl); }
.gap-2xl  { gap: var(--space-2xl); }


// ============================================================================
// GRID UTILITIES
// ============================================================================

.grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
.grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
.grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
.grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
.grid-cols-auto { grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); }

.col-span-1 { grid-column: span 1; }
.col-span-2 { grid-column: span 2; }
.col-span-3 { grid-column: span 3; }
.col-span-full { grid-column: 1 / -1; }


// ============================================================================
// TYPOGRAPHY UTILITIES  (v4: cinematic fluid scale)
// ============================================================================

// ── Alignment ───────────────────────────────────────────────────────────────
.text-left   { text-align: left; }
.text-center { text-align: center; }
.text-right  { text-align: right; }

// ── Font weight (from $font-weight map) ──────────────────────────────────────
@each $key, $value in $font-weight {
  .font-#{$key} { font-weight: $value; }
}

// ── Cinematic fluid type scale (v4 NEW) ──────────────────────────────────────
// Replaces static font-size map classes with clamp-based fluid sizing.
// Mirrors the --type-* CSS custom properties in :root.

.text-xs   { font-size: var(--type-xs,   clamp(0.65rem,  0.60rem + 0.20vw, 0.75rem)); }
.text-sm   { font-size: var(--type-sm,   clamp(0.80rem,  0.75rem + 0.25vw, 0.875rem)); }
.text-base { font-size: var(--type-base, clamp(0.9375rem,0.875rem + 0.30vw, 1rem)); }
.text-md   { font-size: var(--type-md,   clamp(1.0625rem,0.95rem  + 0.45vw, 1.25rem)); }
.text-lg   { font-size: var(--type-lg,   clamp(1.25rem,  1.05rem  + 0.80vw, 1.75rem)); }
.text-xl   { font-size: var(--type-xl,   clamp(1.5rem,   1.15rem  + 1.40vw, 2.5rem)); }
.text-2xl  { font-size: var(--type-2xl,  clamp(2rem,     1.40rem  + 2.20vw, 4rem)); }
.text-3xl  { font-size: var(--type-3xl,  clamp(2.5rem,   1.60rem  + 3.20vw, 6rem)); }
.text-4xl  { font-size: var(--type-4xl,  clamp(3rem,     1.80rem  + 4.50vw, 9rem)); }

// ── Tracking (letter-spacing) ─────────────────────────────────────────────────
.tracking-tight   { letter-spacing: var(--type-tracking-tight,   -0.03em); }
.tracking-normal  { letter-spacing: var(--type-tracking-normal,   0em); }
.tracking-wide    { letter-spacing: var(--type-tracking-wide,     0.04em); }
.tracking-wider   { letter-spacing: var(--type-tracking-wider,    0.08em); }
.tracking-widest  { letter-spacing: var(--type-tracking-widest,   0.14em); }

// ── Leading (line-height) ─────────────────────────────────────────────────────
.leading-tight  { line-height: var(--type-leading-tight,  1.10); }
.leading-snug   { line-height: var(--type-leading-snug,   1.25); }
.leading-normal { line-height: var(--type-leading-normal, 1.55); }
.leading-loose  { line-height: var(--type-leading-loose,  1.80); }

// ── Font families ──────────────────────────────────────────────────────────────
.font-display { font-family: var(--font-display); }
.font-body    { font-family: var(--font-body); }
.font-mono    { font-family: 'JetBrains Mono', 'Fira Code', ui-monospace, monospace; }

// ── Colour ─────────────────────────────────────────────────────────────────────
.text-primary   { color: var(--text-primary); }
.text-secondary { color: var(--text-secondary); }
.text-muted     { color: var(--text-muted); }
.text-inverse   { color: var(--text-inverse); }
.text-accent    { color: var(--accent-primary); }
.text-success   { color: var(--success); }
.text-warning   { color: var(--warning); }
.text-error     { color: var(--error); }
.text-info      { color: var(--info); }

// ── Gradient text fill (v4 NEW) ───────────────────────────────────────────────
// Theme-aware gradient fill on any inline text element.
.text-gradient {
  background: var(--accent-gradient);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.text-gradient-accent {
  background: var(--accent-gradient);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  filter: drop-shadow(0 1px 4px var(--accent-glow));
}

// ── Cinematic display heading (v4 NEW) ────────────────────────────────────────
// Full fluid cinematic heading: gradient fill + glow drop-shadow.
.text-cinematic {
  font-family: var(--font-display);
  font-size: var(--type-4xl, clamp(3rem, 1.80rem + 4.50vw, 9rem));
  font-weight: 800;
  line-height: var(--type-leading-tight, 1.10);
  letter-spacing: var(--type-tracking-tight, -0.03em);
  background: var(--accent-gradient);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  filter: drop-shadow(0 2px 8px var(--accent-glow));
}

// ── Spatial label (v4 NEW) ────────────────────────────────────────────────────
// Wide-tracked uppercase micro-type for section/group labels.
.text-spatial {
  font-family: var(--font-display);
  font-size: var(--type-xs, 0.6875rem);
  font-weight: 700;
  letter-spacing: var(--type-tracking-widest, 0.14em);
  text-transform: uppercase;
  color: var(--text-muted);
}

// ── Overflow / wrap ───────────────────────────────────────────────────────────
.text-truncate {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.text-wrap   { white-space: normal; }
.text-nowrap { white-space: nowrap; }
.text-balance { text-wrap: balance; }    // modern heading balance
.text-pretty  { text-wrap: pretty; }     // avoid orphans

// ── Text transform ────────────────────────────────────────────────────────────
.uppercase    { text-transform: uppercase; }
.lowercase    { text-transform: lowercase; }
.capitalize   { text-transform: capitalize; }
.normal-case  { text-transform: none; }


// ============================================================================
// GLASS SURFACE UTILITIES  (v4: multi-layer depth system)
// ============================================================================

/// Base glass — blur + tint + border (all themes inherit via CSS vars)
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(var(--glass-blur)) saturate(1.80) brightness(1.02);
  -webkit-backdrop-filter: blur(var(--glass-blur)) saturate(1.80) brightness(1.02);
  border: 1px solid var(--glass-border);
}

/// Light glass — reduced opacity, tighter blur for secondary surfaces
.glass-sm {
  background: var(--glass-bg-deep);
  backdrop-filter: blur(calc(var(--glass-blur) * 0.5)) saturate(1.60);
  -webkit-backdrop-filter: blur(calc(var(--glass-blur) * 0.5)) saturate(1.60);
  border: 1px solid var(--glass-border-subtle);
}

/// Heavy glass — maximum blur, deep saturation for modals / overlays
.glass-deep {
  background: var(--glass-bg-deep);
  backdrop-filter: blur(var(--glass-blur-heavy)) saturate(2.20) brightness(1.01);
  -webkit-backdrop-filter: blur(var(--glass-blur-heavy)) saturate(2.20) brightness(1.01);
  border: 1px solid var(--glass-border-strong);
}

/// Refraction layer (v4 NEW) — prismatic top-edge specular.
/// Apply to a positioned element with ::before for cinematic shimmer.
.glass-refract {
  position: relative;
  overflow: hidden;

  &::before {
    content: '';
    position: absolute; inset: 0;
    border-radius: inherit;
    background: linear-gradient(
      var(--glass-refract-angle, 145deg),
      var(--glass-refract-light, rgba(255,255,255,.55)) 0%,
      var(--glass-refract-mid,   rgba(255,255,255,.08)) 22%,
      transparent 55%
    );
    mix-blend-mode: screen;
    pointer-events: none;
    z-index: 0;
  }

  & > * { position: relative; z-index: 1; }
}

/// Prism border (v4 NEW) — animated rainbow-edge shimmer.
.glass-prism {
  border: 1.5px solid transparent;
  background-clip: padding-box;
  position: relative;

  &::before {
    content: '';
    position: absolute;
    inset: -1.5px;
    border-radius: calc(var(--radius-xl) + 1.5px);
    background: linear-gradient(
      145deg,
      rgba(255,100,100,.50)  0%,
      rgba(255,180,50,.40)   14%,
      rgba(200,255,60,.35)   28%,
      rgba(50,230,255,.45)   42%,
      rgba(120,100,255,.50)  56%,
      rgba(240,80,200,.45)   70%,
      rgba(255,100,100,.50) 100%
    );
    background-size: 200% 200%;
    z-index: -1;
    opacity: 0.55;
    animation: prism-rotate 6s linear infinite;
    transition: opacity var(--duration-base) var(--ease-smooth);
  }

  &:hover::before {
    opacity: 0.90;
    animation-duration: 3s;
  }
}

@keyframes prism-rotate {
  0%   { background-position: 0%   50%; }
  50%  { background-position: 100% 50%; }
  100% { background-position: 0%   50%; }
}


// ============================================================================
// BACKGROUND UTILITIES  (v4 UPGRADED)
// ============================================================================

.bg-body      { background: var(--bg-primary); }
.bg-surface   { background: var(--bg-secondary); }
.bg-tertiary  { background: var(--bg-tertiary); }
.bg-primary   { background: var(--accent-primary); }
.bg-gradient  { background: var(--accent-gradient); }
.bg-accent    { background: var(--accent-gradient); }

/// Animated gradient mesh background (v4 NEW).
/// Layers 3 radial accent blooms over the theme gradient.
.bg-mesh {
  background:
    radial-gradient(ellipse 80% 60% at 20% 20%, color-mix(in srgb, var(--accent-primary)  8%, transparent) 0%, transparent 60%),
    radial-gradient(ellipse 60% 80% at 80% 80%, color-mix(in srgb, var(--accent-secondary) 6%, transparent) 0%, transparent 60%),
    radial-gradient(ellipse 70% 50% at 60% 10%, color-mix(in srgb, var(--accent-tertiary)  5%, transparent) 0%, transparent 60%),
    var(--bg-gradient);
  background-size: 200% 200%, 200% 200%, 200% 200%, cover;
}

/// Fixed-attachment mesh with animation.
.bg-mesh-fixed {
  @extend .bg-mesh;
  background-attachment: fixed;
  animation: mesh-drift var(--mesh-speed, 18s) var(--ease-smooth) infinite alternate;
}

@keyframes mesh-drift {
  0%   { background-position: 0%   0%,   0%   0%,   0%   0%,   center; }
  33%  { background-position: 100% 30%,  70%  20%,  30%  80%,  center; }
  66%  { background-position: 60%  100%, 40%  90%,  80%  30%,  center; }
  100% { background-position: 0%   60%,  100% 50%,  50%  100%, center; }
}

/// Noise grain overlay (v4 NEW).
/// Apply to a fixed ::before / ::after pseudo-element.
.noise-grain {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='256' height='256'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.68' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='256' height='256' filter='url(%23n)' opacity='0.028'/%3E%3C/svg%3E");
  opacity: 0.50;
  pointer-events: none;
}

// ── Semantic backgrounds ──────────────────────────────────────────────────────
.bg-success { background: var(--success-bg); }
.bg-warning { background: var(--warning-bg); }
.bg-error   { background: var(--error-bg); }
.bg-info    { background: var(--info-bg); }


// ============================================================================
// BORDER RADIUS UTILITIES
// ============================================================================

@each $key, $value in $radius {
  .rounded-#{$key} { border-radius: $value; }
}

.rounded-none { border-radius: 0; }


// ============================================================================
// BORDER UTILITIES
// ============================================================================

.border         { border: 1px solid var(--glass-border); }
.border-strong  { border: 1px solid var(--glass-border-strong); }
.border-subtle  { border: 1px solid var(--glass-border-subtle); }
.border-accent  { border: 1px solid var(--accent-primary); }
.border-none    { border: none; }

.border-t { border-top: 1px solid var(--glass-border); }
.border-r { border-right: 1px solid var(--glass-border); }
.border-b { border-bottom: 1px solid var(--glass-border); }
.border-l { border-left: 1px solid var(--glass-border); }

/// Prism border (v4 NEW) — standalone without card component
.border-prism {
  border: 1.5px solid transparent;
  background-clip: padding-box;
  position: relative;

  &::after {
    content: '';
    position: absolute;
    inset: -1.5px;
    border-radius: inherit;
    background: linear-gradient(
      145deg,
      rgba(255,100,100,.45) 0%,
      rgba(50,230,255,.40)  33%,
      rgba(120,100,255,.45) 66%,
      rgba(255,100,100,.45) 100%
    );
    background-size: 200% 200%;
    animation: prism-rotate 8s linear infinite;
    z-index: -1;
    opacity: 0.50;
  }
}


// ============================================================================
// ELEVATION UTILITIES  (v4 NEW — 3D shadow token stack)
// ============================================================================

/// Zero elevation — flat, no shadow.
.elev-0 { box-shadow: none; }

/// Elev 1 — subtle lift, micro surfaces.
.elev-1 { box-shadow: var(--elev-1, 0 1px 3px rgba(0,0,0,.06), 0 1px 2px rgba(0,0,0,.04)); }

/// Elev 2 — card resting state.
.elev-2 { box-shadow: var(--elev-2, 0 4px 12px rgba(0,0,0,.08), 0 2px 4px rgba(0,0,0,.05), 0 0 0 1px rgba(255,255,255,.08)); }

/// Elev 3 — floating card, nav panel.
.elev-3 { box-shadow: var(--elev-3, 0 8px 24px rgba(0,0,0,.10), 0 4px 8px rgba(0,0,0,.06), 0 0 0 1px rgba(255,255,255,.10), inset 0 1px 0 rgba(255,255,255,.12)); }

/// Elev 4 — modal, dropdown, sidebar.
.elev-4 { box-shadow: var(--elev-4, 0 16px 40px rgba(0,0,0,.12), 0 8px 16px rgba(0,0,0,.07), 0 0 0 1px rgba(255,255,255,.12), inset 0 1px 0 rgba(255,255,255,.16)); }

/// Elev 5 — top-layer dialog, tooltip, overlay.
.elev-5 { box-shadow: var(--elev-5, 0 28px 64px rgba(0,0,0,.16), 0 12px 24px rgba(0,0,0,.09), 0 0 0 1px rgba(255,255,255,.14), inset 0 1px 0 rgba(255,255,255,.20)); }


// ============================================================================
// SHADOW UTILITIES  (preserved architecture + v4 glow variants)
// ============================================================================

@each $key, $value in $shadow {
  .shadow-#{$key} { box-shadow: #{$value}; }
}

.shadow-glow       { box-shadow: var(--shadow-glow); }
.shadow-inset      { box-shadow: var(--shadow-inset); }


// ============================================================================
// EDGE GLOW UTILITIES  (v4 NEW — ambient accent ring)
// ============================================================================

/// Small edge glow — subtle accent halo.
.edge-glow-sm { box-shadow: var(--edge-glow-sm, 0 0 12px -2px var(--accent-glow)); }

/// Medium edge glow — two-stop glow, standard interactive feedback.
.edge-glow-md { box-shadow: var(--edge-glow-md, 0 0 24px -4px var(--accent-glow), 0 0 48px -8px var(--accent-glow)); }

/// Large edge glow — three-stop cinematic bloom.
.edge-glow-lg { box-shadow: var(--edge-glow-lg, 0 0 40px -6px var(--accent-glow), 0 0 80px -12px var(--accent-glow), 0 0 120px -20px var(--accent-glow)); }

/// Pulse animation variant — breathes between sm and md.
.edge-glow-pulse {
  animation: edge-pulse 2.6s var(--ease-smooth) infinite;

  @keyframes edge-pulse {
    0%, 100% { box-shadow: var(--edge-glow-sm, 0 0 12px -2px var(--accent-glow)); }
    50%      { box-shadow: var(--edge-glow-md, 0 0 24px -4px var(--accent-glow), 0 0 48px -8px var(--accent-glow)); }
  }
}


// ============================================================================
// AURA UTILITIES  (v4 NEW — 3-layer accent aura)
// ============================================================================

/// Subtle aura — near ring + soft mid glow. Ideal for secondary buttons.
.aura-subtle {
  box-shadow:
    0 0 0 1px  color-mix(in srgb, var(--accent-primary) 16%, transparent),
    0 4px 16px color-mix(in srgb, var(--accent-primary) 20%, transparent);
}

/// Normal aura — near + mid + far. Standard primary button / active state.
.aura-normal {
  box-shadow:
    0 0 0 1px  color-mix(in srgb, var(--accent-primary) 22%, transparent),
    0 4px 20px color-mix(in srgb, var(--accent-primary) 30%, transparent),
    0 12px 48px color-mix(in srgb, var(--accent-primary) 18%, transparent);
}

/// Intense aura — 4-stop deep bloom. Hero CTAs, active nav items.
.aura-intense {
  box-shadow:
    0 0 0 1px  color-mix(in srgb, var(--accent-primary) 35%, transparent),
    0 4px 24px color-mix(in srgb, var(--accent-primary) 50%, transparent),
    0 16px 60px color-mix(in srgb, var(--accent-primary) 28%, transparent),
    0 32px 96px color-mix(in srgb, var(--accent-primary) 16%, transparent);
}


// ============================================================================
// LIGHT SCATTER UTILITIES  (v4 NEW)
// ============================================================================

/// Simulates inset directional light scattering on bright glass surfaces.
.scatter-light {
  box-shadow:
    inset  0  1px 0 rgba(255,255,255,.80),
    inset  0 -1px 0 rgba(0,0,0,.06),
    inset  1px 0 0 rgba(255,255,255,.30),
    inset -1px 0 0 rgba(255,255,255,.10);
}

/// Simulates inset scattering for dark glass surfaces.
.scatter-dark {
  box-shadow:
    inset  0  1px 0 rgba(255,255,255,.12),
    inset  0 -1px 0 rgba(0,0,0,.30),
    inset  1px 0 0 rgba(255,255,255,.06),
    inset -1px 0 0 rgba(0,0,0,.06);
}


// ============================================================================
// DEPTH LIGHT UTILITIES  (v4 NEW)
// ============================================================================

/// Radial depth light — directional bloom from top of surface.
.depth-light {
  position: relative;

  &::after {
    content: '';
    position: absolute; inset: 0;
    border-radius: inherit;
    background: radial-gradient(
      ellipse 50% 35% at var(--light-x, 50%) var(--light-y, 30%),
      var(--light-primary, rgba(255,255,255,.22)) 0%,
      var(--light-scatter, rgba(255,255,255,.08)) 50%,
      transparent 100%
    );
    mix-blend-mode: screen;
    pointer-events: none;
    z-index: 0;
    opacity: 0.70;
  }

  & > * { position: relative; z-index: 1; }
}

/// Ambient ceiling light — soft bloom from the top edge only.
.depth-light-deep {
  position: relative;

  &::after {
    content: '';
    position: absolute; inset: 0;
    border-radius: inherit;
    background: radial-gradient(
      ellipse 80% 60% at 50% 0%,
      var(--light-ambient, rgba(255,255,255,.06)) 0%,
      transparent 70%
    );
    mix-blend-mode: screen;
    pointer-events: none;
    z-index: 0;
  }

  & > * { position: relative; z-index: 1; }
}


// ============================================================================
// MAGNETIC LIFT UTILITIES  (v4 NEW — spring physics hover transforms)
// ============================================================================

/// Lift sm — micro elevation. Nav items, badges, small buttons.
.lift-sm {
  transition:
    transform var(--duration-base) var(--ease-spring),
    box-shadow var(--duration-base) var(--ease-smooth);

  &:hover  { transform: var(--lift-sm, translateY(-2px) scale(1.005)); }
  &:active { transform: var(--lift-press, translateY(1px) scale(.975)); }
}

/// Lift md — standard card elevation.
.lift-md {
  transition:
    transform var(--duration-base) var(--ease-spring),
    box-shadow var(--duration-base) var(--ease-smooth);

  &:hover  { transform: var(--lift-md, translateY(-4px) scale(1.010)); }
  &:active { transform: var(--lift-press, translateY(1px) scale(.975)); }
}

/// Lift lg — dramatic hero element lift.
.lift-lg {
  transition:
    transform var(--duration-base) var(--ease-spring),
    box-shadow var(--duration-base) var(--ease-smooth);

  &:hover  { transform: var(--lift-lg, translateY(-8px) scale(1.016)); }
  &:active { transform: var(--lift-press, translateY(1px) scale(.975)); }
}

/// Press only — depresses on active (no hover lift).
.lift-press {
  transition: transform var(--duration-fast) var(--ease-spring);
  &:active { transform: var(--lift-press, translateY(1px) scale(.975)); }
}


// ============================================================================
// CONTRAST HELPERS  (v4 NEW — intelligent filter boosts)
// ============================================================================

/// Boost brightness + contrast for light glass surfaces needing more pop.
.contrast-boost {
  filter: var(--contrast-boost-light, brightness(1.05) contrast(1.08));
}

/// Darker contrast boost for crisp dark-theme readability.
.contrast-boost-dark {
  filter: var(--contrast-boost-dark, brightness(1.08) contrast(1.12));
}


// ============================================================================
// GLASS CARD UTILITIES  (v4: full depth-lit upgrade)
// ============================================================================

/// Primary glass card — full multi-layer surface with hover depth.
.glass-card {
  @include glass-card();
}

/// Deep glass card variant — heavier blur, for modals / overlays.
.glass-card-deep {
  @include glass-card-deep();
}

/// Stat / KPI card.
.glass-stat-card {
  @include glass-stat-card();
}


// ============================================================================
// GLASS BUTTON UTILITIES  (v4: liquid glass)
// ============================================================================

/// Standard glass button.
.glass-button {
  @include glass-button();
}

/// Primary gradient button with aura.
.glass-button-primary {
  @include glass-button-primary();
}

/// Liquid glow pulsing button.
.glass-button-liquid {
  @include glass-button-liquid();
}

@keyframes aura-breathe {
  0%,100% { box-shadow: var(--elev-2), var(--edge-glow-sm, 0 0 12px -2px var(--accent-glow)); }
  50%     { box-shadow: var(--elev-3), var(--edge-glow-md, 0 0 24px -4px var(--accent-glow)); }
}


// ============================================================================
// ICON UTILITIES  (v4: glow + spatial sizing)
// ============================================================================

.icon-glow {
  transition: all var(--duration-fast) var(--ease-smooth);

  &:hover {
    color: var(--accent-primary);
    filter: drop-shadow(0 0 8px var(--accent-glow)) drop-shadow(0 0 16px var(--accent-glow));
    transform: scale(1.12);
  }
}

// Spatial icon sizes — mapped to type scale
.icon-xs  { font-size: var(--type-xs);   width: 1em; height: 1em; }
.icon-sm  { font-size: var(--type-sm);   width: 1em; height: 1em; }
.icon-md  { font-size: var(--type-md);   width: 1em; height: 1em; }
.icon-lg  { font-size: var(--type-lg);   width: 1em; height: 1em; }
.icon-xl  { font-size: var(--type-xl);   width: 1em; height: 1em; }
.icon-2xl { font-size: var(--type-2xl);  width: 1em; height: 1em; }


// ============================================================================
// WIDTH / HEIGHT UTILITIES
// ============================================================================

.w-full    { width: 100%; }
.w-auto    { width: auto; }
.w-screen  { width: 100vw; }
.w-min     { width: min-content; }
.w-max     { width: max-content; }
.w-fit     { width: fit-content; }

.h-full    { height: 100%; }
.h-auto    { height: auto; }
.h-screen  { height: 100vh; }
.h-svh     { height: 100svh; }
.min-h-screen { min-height: 100vh; }


// ============================================================================
// ASPECT RATIO UTILITIES  (v4 NEW)
// ============================================================================

.aspect-square   { aspect-ratio: 1 / 1; }
.aspect-video    { aspect-ratio: 16 / 9; }
.aspect-wide     { aspect-ratio: 21 / 9; }
.aspect-portrait { aspect-ratio: 3 / 4; }
.aspect-auto     { aspect-ratio: auto; }


// ============================================================================
// POSITION UTILITIES
// ============================================================================

.position-static   { position: static; }
.position-relative { position: relative; }
.position-absolute { position: absolute; }
.position-fixed    { position: fixed; }
.position-sticky   { position: sticky; }

// Inset helpers
.inset-0    { inset: 0; }
.inset-auto { inset: auto; }
.top-0      { top: 0; }
.right-0    { right: 0; }
.bottom-0   { bottom: 0; }
.left-0     { left: 0; }


// ============================================================================
// Z-INDEX UTILITIES
// ============================================================================

.z-0    { z-index: 0; }
.z-10   { z-index: 10; }
.z-20   { z-index: 20; }
.z-30   { z-index: 30; }
.z-40   { z-index: 40; }
.z-50   { z-index: 50; }
.z-auto { z-index: auto; }

// Named semantic z-levels (from $z-index map if available)
.z-modal   { z-index: map.get($z-index, 'modal',   1000); }
.z-overlay { z-index: map.get($z-index, 'overlay', 900); }
.z-sticky  { z-index: map.get($z-index, 'sticky',  100); }
.z-fixed   { z-index: map.get($z-index, 'fixed',   200); }


// ============================================================================
// ISOLATION (v4 NEW — stacking context helpers)
// ============================================================================

.isolate         { isolation: isolate; }
.isolation-auto  { isolation: auto; }


// ============================================================================
// OVERFLOW UTILITIES
// ============================================================================

.overflow-auto    { overflow: auto; }
.overflow-hidden  { overflow: hidden; }
.overflow-visible { overflow: visible; }
.overflow-scroll  { overflow: scroll; }
.overflow-x-auto  { overflow-x: auto; overflow-y: hidden; }
.overflow-y-auto  { overflow-y: auto; overflow-x: hidden; }
.overflow-clip    { overflow: clip; }


// ============================================================================
// POINTER EVENT UTILITIES  (v4 NEW)
// ============================================================================

.events-none { pointer-events: none; }
.events-auto { pointer-events: auto; }


// ============================================================================
// USER SELECT UTILITIES  (v4 NEW)
// ============================================================================

.select-none { user-select: none; }
.select-all  { user-select: all; }
.select-text { user-select: text; }


// ============================================================================
// CURSOR UTILITIES
// ============================================================================

.cursor-pointer     { cursor: pointer; }
.cursor-default     { cursor: default; }
.cursor-not-allowed { cursor: not-allowed; }
.cursor-grab        { cursor: grab; }
.cursor-grabbing    { cursor: grabbing; }
.cursor-text        { cursor: text; }
.cursor-crosshair   { cursor: crosshair; }


// ============================================================================
// OPACITY UTILITIES
// ============================================================================

.opacity-0   { opacity: 0; }
.opacity-20  { opacity: .20; }
.opacity-40  { opacity: .40; }
.opacity-60  { opacity: .60; }
.opacity-80  { opacity: .80; }
.opacity-100 { opacity: 1; }


// ============================================================================
// ANIMATION UTILITIES  (v4 NEW — cinematic motion system)
// ============================================================================

/// Cinematic entrance: blur + scale + translate fade-in.
.animate-entrance {
  animation: anim-entrance var(--duration-slow, 400ms) var(--ease-out, cubic-bezier(0,0,.2,1)) both;

  @keyframes anim-entrance {
    from { opacity: 0; transform: translateY(24px); filter: blur(6px); }
    to   { opacity: 1; transform: translateY(0);    filter: blur(0); }
  }
}

/// Classic fade-up.
.animate-fade-up {
  animation: anim-fade-up var(--duration-slow, 400ms) var(--ease-out) both;

  @keyframes anim-fade-up {
    from { opacity: 0; transform: translateY(20px); }
    to   { opacity: 1; transform: translateY(0); }
  }
}

/// Scale-in entrance.
.animate-scale-in {
  animation: anim-scale-in var(--duration-slow, 400ms) var(--ease-spring) both;

  @keyframes anim-scale-in {
    from { opacity: 0; transform: scale(.94) translateY(12px); filter: blur(6px); }
    to   { opacity: 1; transform: scale(1)   translateY(0);    filter: blur(0); }
  }
}

/// Slide in from left.
.animate-slide-right {
  animation: anim-slide-right var(--duration-slow, 400ms) var(--ease-out) both;

  @keyframes anim-slide-right {
    from { opacity: 0; transform: translateX(-32px); filter: blur(4px); }
    to   { opacity: 1; transform: translateX(0);     filter: blur(0); }
  }
}

/// Ambient float levitation.
.animate-float {
  animation: anim-float 5s var(--ease-smooth) infinite;

  @keyframes anim-float {
    0%, 100% { transform: translateY(0); }
    50%      { transform: translateY(-8px); }
  }
}

/// Shimmer skeleton loading.
.animate-shimmer {
  background: linear-gradient(
    90deg,
    var(--glass-bg)       0%,
    var(--glass-bg-hover) 40%,
    var(--glass-bg)       80%
  );
  background-size: 200%;
  animation: anim-shimmer 2s linear infinite;

  @keyframes anim-shimmer {
    from { background-position: -200% center; }
    to   { background-position:  200% center; }
  }
}

/// Glow pulse.
.animate-pulse-glow {
  animation: anim-pulse-glow 2.6s var(--ease-smooth) infinite;

  @keyframes anim-pulse-glow {
    0%,100% { box-shadow: var(--elev-3); }
    50%     { box-shadow: var(--elev-3), var(--edge-glow-md, 0 0 24px -4px var(--accent-glow)); }
  }
}

/// Continuous spin.
.animate-spin {
  animation: anim-spin .8s linear infinite;

  @keyframes anim-spin { to { transform: rotate(360deg); } }
}

// ── Stagger delay helpers (v4 NEW) ────────────────────────────────────────────
// Apply to parent; children pick up nth-child delays automatically.
// Pairs with .animate-entrance / .animate-fade-up / .animate-scale-in.

.stagger > :nth-child(1) { animation-delay:   0ms; }
.stagger > :nth-child(2) { animation-delay:  60ms; }
.stagger > :nth-child(3) { animation-delay: 120ms; }
.stagger > :nth-child(4) { animation-delay: 180ms; }
.stagger > :nth-child(5) { animation-delay: 240ms; }
.stagger > :nth-child(6) { animation-delay: 300ms; }
.stagger > :nth-child(7) { animation-delay: 360ms; }
.stagger > :nth-child(8) { animation-delay: 420ms; }

// Standalone delay utilities
.stagger-1 { animation-delay:   0ms; }
.stagger-2 { animation-delay:  60ms; }
.stagger-3 { animation-delay: 120ms; }
.stagger-4 { animation-delay: 180ms; }
.stagger-5 { animation-delay: 240ms; }
.stagger-6 { animation-delay: 300ms; }
.stagger-7 { animation-delay: 360ms; }
.stagger-8 { animation-delay: 420ms; }

// ── Duration modifiers ────────────────────────────────────────────────────────
.duration-fast  { animation-duration: var(--duration-fast,  120ms); }
.duration-base  { animation-duration: var(--duration-base,  240ms); }
.duration-slow  { animation-duration: var(--duration-slow,  400ms); }
.duration-xslow { animation-duration: var(--duration-xslow, 700ms); }

// ── Fill mode ─────────────────────────────────────────────────────────────────
.anim-fill-both    { animation-fill-mode: both; }
.anim-fill-forward { animation-fill-mode: forwards; }
.anim-pause        { animation-play-state: paused; }
.anim-play         { animation-play-state: running; }


// ============================================================================
// ACCESSIBILITY UTILITIES
// ============================================================================

.visually-hidden,
.sr-only {
  position: absolute;
  width: 1px; height: 1px;
  padding: 0; margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

.not-sr-only {
  position: static;
  width: auto; height: auto;
  padding: 0; margin: 0;
  overflow: visible;
  clip: auto;
  white-space: normal;
}

.focus-ring {
  &:focus-visible {
    outline: 2px solid var(--accent-primary);
    outline-offset: 3px;
  }
}


// ============================================================================
// REDUCED MOTION OVERRIDE
// ============================================================================

/// Disables all animations for users who prefer reduced motion.
@media (prefers-reduced-motion: reduce) {
  .animate-entrance,
  .animate-fade-up,
  .animate-scale-in,
  .animate-slide-right,
  .animate-float,
  .animate-shimmer,
  .animate-pulse-glow,
  .animate-spin,
  .glass-prism::before,
  .glass-button-liquid,
  .edge-glow-pulse,
  .bg-mesh-fixed,
  .bg-mesh { animation: none !important; transition-duration: .01ms !important; }
}


// ============================================================================
// RESPONSIVE SHOW / HIDE UTILITIES  (v4: show-* + hide-*)
// ============================================================================

// ── Hide at breakpoint and below ──────────────────────────────────────────────
@media (max-width: 575.98px) {
  .hide-xs { display: none !important; }
}

@media (min-width: 576px) and (max-width: 767.98px) {
  .hide-sm { display: none !important; }
}

@media (min-width: 768px) and (max-width: 991.98px) {
  .hide-md { display: none !important; }
}

@media (min-width: 992px) and (max-width: 1199.98px) {
  .hide-lg { display: none !important; }
}

@media (min-width: 1200px) {
  .hide-xl { display: none !important; }
}

// ── Show only at breakpoint ───────────────────────────────────────────────────
.show-xs,
.show-sm,
.show-md,
.show-lg,
.show-xl { display: none !important; }

@media (max-width: 575.98px) {
  .show-xs { display: revert !important; }
}

@media (min-width: 576px) and (max-width: 767.98px) {
  .show-sm { display: revert !important; }
}

@media (min-width: 768px) and (max-width: 991.98px) {
  .show-md { display: revert !important; }
}

@media (min-width: 992px) and (max-width: 1199.98px) {
  .show-lg { display: revert !important; }
}

@media (min-width: 1200px) {
  .show-xl { display: revert !important; }
}