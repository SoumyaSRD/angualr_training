// ============================================================================
// GLASS UI DESIGN SYSTEM v4.0 — MAIN ENTRY
// Cinematic · Spatial · Luminous · Premium
//
// NEW IN v4.0:
// ▸ Syne + DM Sans premium font pairing (replaces Inter)
// ▸ Cinematic heading scale — fluid clamp h1–h6
// ▸ font-feature-settings — kern, liga, calt, cv01, cv02, ss01
// ▸ Multi-layer body background — gradient mesh + noise grain
// ▸ Depth-lit glass-card — refraction + bloom pseudo-layers
// ▸ Liquid glass-btn — sheen + wet-edge + spring lift
// ▸ Premium link treatment — underline slide animation
// ▸ Spatial breadcrumb — wide-tracked, glowing separator
// ▸ Upgraded glass-header — scatter light + elevation
// ▸ Cinematic toast — scale-up entrance, semantic edge glows
// ▸ Premium theme selector — prism border on active, orb bloom
// ▸ Refined scrollbar — accent-on-hover, transparent track
// ▸ Selection — gradient text + accent bg
// ▸ Focus ring — glow halo, not just outline
// ▸ Reduced-motion safety block
// ============================================================================

// ── Sass modules (must be @use before @import) ────────────────────────────────
@use 'variables';
@use 'mixins' as *;
@use 'themes-base';
@use 'animations';
@use 'utilities';

// ── Regular imports (after @use rules) ───────────────────────────────────────
@import 'base';
@import 'typography';




// ============================================================================
// LINKS — premium underline slide treatment
// ============================================================================

a {
  color: var(--accent-primary);
  text-decoration: none;
  position: relative;
  transition: color var(--duration-fast, 120ms) var(--ease-smooth);

  // Animated underline that slides in from left on hover
  &::after {
    content: '';
    position: absolute;
    bottom: -1px; left: 0;
    width: 100%; height: 1px;
    background: var(--accent-gradient);
    transform: scaleX(0);
    transform-origin: right;
    transition: transform var(--duration-base, 240ms) var(--ease-spring, cubic-bezier(.175,.885,.32,1.275));
    border-radius: var(--radius-full, 9999px);
  }

  &:hover {
    color: var(--accent-secondary);

    &::after {
      transform: scaleX(1);
      transform-origin: left;
    }
  }

  // Prevent double underline on nav/button links
  &:where(.glass-btn, .glass-nav__item, [class*="btn"]) {
    &::after { display: none; }
  }
}


// ============================================================================
// LISTS
// ============================================================================

ul, ol { padding-left: var(--space-lg, 24px); }

li { line-height: var(--type-leading-normal, 1.55); margin-bottom: var(--space-xs, 4px); }

// Styled unordered list bullets
ul:not([class]) li::marker { color: var(--accent-primary); }


// ============================================================================
// HORIZONTAL RULE — glass divider
// ============================================================================

hr {
  border: none;
  height: 1px;
  background: linear-gradient(
    90deg,
    transparent,
    var(--glass-border-strong) 30%,
    var(--glass-border-strong) 70%,
    transparent
  );
  margin: var(--space-lg, 24px) 0;
  position: relative;

  // Specular centre dot
  &::after {
    content: '';
    position: absolute;
    top: -1.5px; left: 50%;
    transform: translateX(-50%);
    width: 6px; height: 3px;
    background: var(--glass-specular, rgba(255,255,255,.9));
    border-radius: var(--radius-full);
    opacity: 0.60;
  }
}


// ============================================================================
// SELECTION
// ============================================================================

::selection {
  background: color-mix(in srgb, var(--accent-primary) 28%, transparent);
  color: var(--text-primary);
}


// ============================================================================
// FOCUS RING — glow halo treatment
// ============================================================================

:focus-visible {
  outline: 2px solid var(--accent-primary);
  outline-offset: 3px;
  border-radius: var(--radius-sm, 8px);
  box-shadow: 0 0 0 5px color-mix(in srgb, var(--accent-primary) 18%, transparent);
}

// Remove focus ring on mouse interaction (pointer events only)
:focus:not(:focus-visible) { outline: none; }


// ============================================================================
// SCROLLBAR — thin glass rail
// ============================================================================

::-webkit-scrollbar { width: 5px; height: 5px; }

::-webkit-scrollbar-track { background: transparent; }

::-webkit-scrollbar-thumb {
  background: var(--glass-border-strong);
  border-radius: var(--radius-full);
  transition: background var(--duration-base);

  &:hover { background: var(--accent-primary); }
}

// Firefox
* { scrollbar-width: thin; scrollbar-color: var(--glass-border-strong) transparent; }


// ============================================================================
// GLASS CARD COMPONENT  (v4: depth-lit multi-layer surface)
// ============================================================================

.glass-card {
  position: relative;
  background: var(--glass-bg);
  backdrop-filter: blur(var(--glass-blur, 20px)) saturate(1.80) brightness(1.02);
  -webkit-backdrop-filter: blur(var(--glass-blur, 20px)) saturate(1.80) brightness(1.02);
  border: 1px solid var(--glass-border);
  border-radius: var(--radius-xl, 28px);
  padding: var(--space-lg, 24px);
  box-shadow: var(--elev-3, 0 8px 24px rgba(0,0,0,.10));
  transition:
    background   var(--duration-base) var(--ease-smooth),
    border-color var(--duration-base) var(--ease-smooth),
    box-shadow   var(--duration-base) var(--ease-smooth),
    transform    var(--duration-base) var(--ease-spring);
  overflow: hidden;
  isolation: isolate;

  // ── Refraction layer: prismatic top-edge specular ────────────────────────
  &::before {
    content: '';
    position: absolute; inset: 0;
    border-radius: inherit;
    background:
      linear-gradient(
        var(--glass-refract-angle, 145deg),
        var(--glass-refract-light, rgba(255,255,255,.55)) 0%,
        var(--glass-refract-mid,   rgba(255,255,255,.08)) 22%,
        transparent 55%
      ),
      radial-gradient(
        ellipse 50% 35% at var(--light-x, 50%) var(--light-y, 30%),
        var(--light-primary, rgba(255,255,255,.22)) 0%,
        var(--light-scatter, rgba(255,255,255,.08)) 50%,
        transparent 100%
      );
    mix-blend-mode: screen;
    pointer-events: none;
    z-index: 0;
    opacity: 0.85;
    transition: opacity var(--duration-slow) var(--ease-smooth);
  }

  // ── Ambient depth-light bloom ─────────────────────────────────────────────
  &::after {
    content: '';
    position: absolute; inset: 0;
    border-radius: inherit;
    background: radial-gradient(
      ellipse 80% 60% at 50% 0%,
      var(--light-ambient, rgba(255,255,255,.04)) 0%,
      transparent 70%
    );
    mix-blend-mode: screen;
    pointer-events: none;
    z-index: 0;
    opacity: 0.60;
    transition: opacity var(--duration-slow) var(--ease-smooth);
  }

  // Content above pseudo-layers
  & > * { position: relative; z-index: 1; }

  &:hover {
    background: var(--glass-bg-hover);
    border-color: var(--glass-border-strong);
    box-shadow:
      var(--elev-5, 0 28px 64px rgba(0,0,0,.16)),
      var(--edge-glow-md, 0 0 24px -4px var(--accent-glow));
    transform: var(--lift-md, translateY(-4px) scale(1.010));

    &::before { opacity: 1; }
    &::after  { opacity: 1; }
  }
}


// ============================================================================
// GLASS BUTTON  (v4: liquid glass — sheen + wet edge + spring lift)
// ============================================================================

.glass-btn {
  display: inline-flex;
  align-items: center;
  gap: var(--space-xs, 8px);
  padding: 11px 24px;
  background: var(--glass-bg);
  backdrop-filter: blur(var(--glass-blur, 20px)) saturate(1.80);
  -webkit-backdrop-filter: blur(var(--glass-blur, 20px)) saturate(1.80);
  border: 1px solid var(--glass-border);
  border-radius: var(--radius-full, 9999px);
  color: var(--text-primary);
  font-family: var(--font-display, 'Syne', sans-serif);
  font-weight: 600;
  font-size: var(--type-sm, 0.875rem);
  letter-spacing: var(--type-tracking-wide, 0.04em);
  cursor: pointer;
  position: relative;
  overflow: hidden;
  isolation: isolate;
  transition:
    filter     var(--duration-base) var(--ease-smooth),
    box-shadow var(--duration-base) var(--ease-smooth),
    transform  var(--duration-fast) var(--ease-spring-heavy, cubic-bezier(.34,1.56,.64,1));

  // Liquid specular sheen — brightens toward top-left on hover
  &::before {
    content: '';
    position: absolute; inset: 0;
    border-radius: inherit;
    background: linear-gradient(
      160deg,
      rgba(255,255,255,.30) 0%,
      rgba(255,255,255,.08) 30%,
      transparent           60%
    );
    opacity: .75;
    pointer-events: none;
    transition: opacity var(--duration-base) var(--ease-smooth);
  }

  // Wet base-edge gloss
  &::after {
    content: '';
    position: absolute;
    bottom: 0; left: 10%; right: 10%;
    height: 1px;
    background: rgba(255,255,255,.22);
    border-radius: var(--radius-full);
    pointer-events: none;
  }

  &:hover {
    background: var(--glass-bg-hover);
    border-color: var(--glass-border-strong);
    box-shadow: var(--elev-3), var(--edge-glow-sm, 0 0 12px -2px var(--accent-glow));
    transform: var(--lift-sm, translateY(-2px) scale(1.005));
    &::before { opacity: 1; }
  }

  &:active { transform: var(--lift-press, translateY(1px) scale(.975)); }

  &:focus-visible {
    outline: 2px solid var(--accent-primary);
    outline-offset: 3px;
    box-shadow: 0 0 0 5px color-mix(in srgb, var(--accent-primary) 18%, transparent);
  }

  // ── Primary variant — full gradient + aura ────────────────────────────────
  &.btn-primary {
    background: var(--accent-gradient);
    border-color: color-mix(in srgb, var(--accent-secondary) 30%, transparent);
    color: var(--text-on-accent, #fff);
    box-shadow:
      var(--elev-2),
      0 0 0 1px  color-mix(in srgb, var(--accent-primary) 22%, transparent),
      0 4px 20px color-mix(in srgb, var(--accent-primary) 30%, transparent);

    &:hover {
      filter: brightness(1.10);
      box-shadow:
        var(--elev-3),
        var(--edge-glow-md, 0 0 24px -4px var(--accent-glow));
      transform: var(--lift-sm);
    }
  }

  // ── Outline variant ───────────────────────────────────────────────────────
  &.btn-outline {
    background: transparent;
    border-color: var(--accent-primary);
    color: var(--accent-primary);

    &:hover {
      background: color-mix(in srgb, var(--accent-primary) 8%, transparent);
      box-shadow: var(--edge-glow-sm);
    }
  }

  // ── Liquid glow variant ───────────────────────────────────────────────────
  &.btn-liquid {
    background: var(--accent-gradient);
    color: var(--text-on-accent, #fff);
    box-shadow: var(--edge-glow-md, 0 0 24px -4px var(--accent-glow));
    animation: aura-breathe 3s var(--ease-smooth) infinite;

    &:hover {
      box-shadow: var(--edge-glow-lg);
      transform: var(--lift-md);
      animation-play-state: paused;
      filter: brightness(1.10);
    }
  }

  // ── Size variants ─────────────────────────────────────────────────────────
  &.btn-sm  { font-size: var(--type-xs);  padding: 7px 16px; }
  &.btn-lg  { font-size: var(--type-md);  padding: 14px 32px; }
  &.btn-icon { padding: 10px; border-radius: var(--radius-md, 12px); }
}

@keyframes aura-breathe {
  0%,100% { box-shadow: var(--elev-2), var(--edge-glow-sm, 0 0 12px -2px var(--accent-glow)); }
  50%     { box-shadow: var(--elev-3), var(--edge-glow-md, 0 0 24px -4px var(--accent-glow)); }
}


// ============================================================================
// APP LAYOUT
// ============================================================================

.app-layout {
  display: flex;
  min-height: 100vh;
}

.main-content {
  flex: 1;
  margin-left: 280px;
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  transition: margin-left var(--duration-base) var(--ease-smooth);

  &.sidebar-collapsed { margin-left: 72px; }
}


// ============================================================================
// GLASS HEADER  (v4: scatter light + elevation + depth-lit surface)
// ============================================================================

.glass-header {
  position: sticky;
  top: 0;
  height: 68px;
  background: var(--glass-bg);
  backdrop-filter: blur(var(--glass-blur, 20px)) saturate(1.80);
  -webkit-backdrop-filter: blur(var(--glass-blur, 20px)) saturate(1.80);
  border-bottom: 1px solid var(--glass-border);
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 var(--space-lg, 24px);
  z-index: var(--z-sticky, 1020);
  box-shadow:
    var(--elev-3),
    var(--scatter-soft,
      inset  0  1px 0 rgba(255,255,255,.80),
      inset  0 -1px 0 rgba(0,0,0,.06));

  // Ambient top-edge glow trace
  &::after {
    content: '';
    position: absolute;
    top: 0; left: 5%; right: 5%;
    height: 1px;
    background: linear-gradient(
      90deg,
      transparent,
      color-mix(in srgb, var(--accent-primary) 40%, transparent) 30%,
      color-mix(in srgb, var(--accent-primary) 40%, transparent) 70%,
      transparent
    );
    opacity: 0.70;
    pointer-events: none;
  }
}


// ============================================================================
// BREADCRUMB  (v4: spatial micro-type + glowing separator)
// ============================================================================

.breadcrumb-nav {
  padding: var(--space-md, 16px) var(--space-lg, 24px);
  background: var(--glass-bg-deep, rgba(255,255,255,.25));
  backdrop-filter: blur(calc(var(--glass-blur, 20px) * 0.5));
  -webkit-backdrop-filter: blur(calc(var(--glass-blur, 20px) * 0.5));
  border-bottom: 1px solid var(--glass-border-subtle);
}

.breadcrumb {
  display: flex;
  align-items: center;
  gap: var(--space-sm, 8px);
  list-style: none;
  font-family: var(--font-display, 'Syne', sans-serif);
  font-size: var(--type-xs, 0.6875rem);
  font-weight: 700;
  letter-spacing: var(--type-tracking-wider, 0.08em);
  text-transform: uppercase;
}

.breadcrumb-item {
  display: flex;
  align-items: center;
  gap: var(--space-sm, 8px);

  a {
    color: var(--text-muted);
    transition: color var(--duration-fast) var(--ease-smooth);

    // Suppress default link underline animation inside breadcrumb
    &::after { display: none; }

    &:hover { color: var(--accent-primary); }
  }

  &.active {
    color: var(--text-primary);
  }
}

// Glowing accent separator (replaces plain '/')
.breadcrumb-item + .breadcrumb-item::before {
  content: '›';
  color: var(--accent-primary);
  font-size: 0.85em;
  opacity: 0.55;
  filter: drop-shadow(0 0 4px var(--accent-glow, rgba(99,102,241,.35)));
}


// ============================================================================
// CONTENT AREA
// ============================================================================

.content-wrapper {
  flex: 1;
  padding: var(--space-lg, 24px);
  overflow-x: hidden;
}


// ============================================================================
// TOAST NOTIFICATIONS  (v4: scale-up entrance + semantic edge glows)
// ============================================================================

.toast-container {
  position: fixed;
  top: var(--space-lg, 24px);
  right: var(--space-lg, 24px);
  z-index: var(--z-toast, 1080);
  display: flex;
  flex-direction: column;
  gap: var(--space-sm, 12px);
  pointer-events: none;
}

.glass-toast {
  display: flex;
  align-items: flex-start;
  gap: var(--space-sm, 12px);
  padding: var(--space-md, 16px) var(--space-lg, 24px);
  background: var(--glass-bg-hover);
  backdrop-filter: blur(var(--glass-blur-heavy, 40px)) saturate(2.20);
  -webkit-backdrop-filter: blur(var(--glass-blur-heavy, 40px)) saturate(2.20);
  border: 1px solid var(--glass-border);
  border-radius: var(--radius-lg, 20px);
  box-shadow: var(--elev-5);
  min-width: 320px;
  max-width: 420px;
  pointer-events: auto;
  animation: toast-entrance 0.35s var(--ease-spring, cubic-bezier(.175,.885,.32,1.275)) both;

  // Semantic edge glow variants
  &.toast-success {
    border-color: color-mix(in srgb, var(--success) 38%, transparent);
    box-shadow: var(--elev-5), 0 0 20px -4px color-mix(in srgb, var(--success) 28%, transparent);
  }

  &.toast-error {
    border-color: color-mix(in srgb, var(--error) 38%, transparent);
    box-shadow: var(--elev-5), 0 0 20px -4px color-mix(in srgb, var(--error) 28%, transparent);
  }

  &.toast-warning {
    border-color: color-mix(in srgb, var(--warning) 38%, transparent);
    box-shadow: var(--elev-5), 0 0 20px -4px color-mix(in srgb, var(--warning) 28%, transparent);
  }

  &.toast-info {
    border-color: color-mix(in srgb, var(--info) 38%, transparent);
    box-shadow: var(--elev-5), 0 0 20px -4px color-mix(in srgb, var(--info) 28%, transparent);
  }
}

@keyframes toast-entrance {
  from {
    opacity: 0;
    transform: translateX(48px) scale(.92);
    filter: blur(4px);
  }
  to {
    opacity: 1;
    transform: translateX(0) scale(1);
    filter: blur(0);
  }
}

.toast-icon {
  font-size: var(--type-md, 1.25rem);
  flex-shrink: 0;
  margin-top: 1px;
}

.toast-success .toast-icon { color: var(--success); filter: drop-shadow(0 0 6px color-mix(in srgb, var(--success) 55%, transparent)); }
.toast-error   .toast-icon { color: var(--error);   filter: drop-shadow(0 0 6px color-mix(in srgb, var(--error)   55%, transparent)); }
.toast-warning .toast-icon { color: var(--warning); filter: drop-shadow(0 0 6px color-mix(in srgb, var(--warning) 55%, transparent)); }
.toast-info    .toast-icon { color: var(--info);    filter: drop-shadow(0 0 6px color-mix(in srgb, var(--info)    55%, transparent)); }

.toast-content { flex: 1; }

.toast-title {
  font-family: var(--font-display, 'Syne', sans-serif);
  font-size: var(--type-sm, 0.875rem);
  font-weight: 700;
  letter-spacing: var(--type-tracking-wide, 0.04em);
  color: var(--text-primary);
  margin-bottom: 2px;
}

.toast-message {
  font-size: var(--type-sm, 0.875rem);
  color: var(--text-secondary);
  line-height: var(--type-leading-normal, 1.55);
}

.toast-close {
  flex-shrink: 0;
  background: none;
  border: none;
  color: var(--text-muted);
  cursor: pointer;
  padding: 4px;
  border-radius: var(--radius-sm, 8px);
  transition: all var(--duration-fast) var(--ease-smooth);
  display: flex;
  align-items: center;
  justify-content: center;

  &:hover {
    background: var(--glass-bg-hover);
    color: var(--text-primary);
    transform: scale(1.12);
  }
}


// ============================================================================
// THEME SELECTOR  (v4: prism border on active + orb bloom)
// ============================================================================

.theme-selector {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: var(--space-sm, 12px);
}

.theme-option {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--space-sm, 8px);
  padding: var(--space-md, 16px) var(--space-sm, 12px);
  background: var(--glass-bg);
  backdrop-filter: blur(var(--glass-blur));
  -webkit-backdrop-filter: blur(var(--glass-blur));
  border: 1.5px solid var(--glass-border);
  border-radius: var(--radius-lg, 20px);
  cursor: pointer;
  position: relative;
  overflow: hidden;
  isolation: isolate;
  transition:
    background    var(--duration-base) var(--ease-smooth),
    border-color  var(--duration-base) var(--ease-smooth),
    box-shadow    var(--duration-base) var(--ease-smooth),
    transform     var(--duration-base) var(--ease-spring);

  // Refraction highlight
  &::before {
    content: '';
    position: absolute; inset: 0;
    border-radius: inherit;
    background: linear-gradient(
      145deg,
      var(--glass-refract-light, rgba(255,255,255,.55)) 0%,
      transparent 45%
    );
    mix-blend-mode: screen;
    pointer-events: none;
    opacity: 0.70;
    transition: opacity var(--duration-base) var(--ease-smooth);
  }

  & > * { position: relative; z-index: 1; }

  &:hover {
    background: var(--glass-bg-hover);
    border-color: var(--glass-border-strong);
    transform: var(--lift-md, translateY(-4px) scale(1.010));
    box-shadow: var(--elev-3);

    &::before { opacity: 1; }
  }

  // Active: prism border + full aura glow
  &.active {
    border-color: var(--accent-primary);
    box-shadow:
      var(--elev-3),
      0 0 0 1px  color-mix(in srgb, var(--accent-primary) 22%, transparent),
      0 4px 20px color-mix(in srgb, var(--accent-primary) 30%, transparent),
      0 12px 48px color-mix(in srgb, var(--accent-primary) 18%, transparent);

    // Prism shimmer on active border
    &::after {
      content: '';
      position: absolute;
      inset: -1.5px;
      border-radius: calc(var(--radius-lg, 20px) + 1.5px);
      background: var(--prism-border, linear-gradient(145deg, rgba(255,100,100,.50) 0%, rgba(50,230,255,.45) 42%, rgba(240,80,200,.45) 70%, rgba(255,100,100,.50) 100%));
      background-size: 200% 200%;
      animation: prism-rotate 6s linear infinite;
      z-index: -1;
      opacity: 0.60;
    }
  }
}

@keyframes prism-rotate {
  0%   { background-position: 0%   50%; }
  50%  { background-position: 100% 50%; }
  100% { background-position: 0%   50%; }
}

// Theme preview swatch — rounded with depth shadow
.theme-preview {
  width: 48px;
  height: 48px;
  border-radius: var(--radius-md, 12px);
  box-shadow: var(--elev-3);
  flex-shrink: 0;
  transition: transform var(--duration-base) var(--ease-spring);

  .theme-option:hover & { transform: scale(1.08) rotate(-2deg); }
  .theme-option.active & { transform: scale(1.12); box-shadow: var(--elev-4), var(--edge-glow-sm); }
}

// Theme name label
.theme-name {
  font-family: var(--font-display, 'Syne', sans-serif);
  font-size: var(--type-xs, 0.6875rem);
  font-weight: 700;
  letter-spacing: var(--type-tracking-wider, 0.08em);
  text-transform: uppercase;
  color: var(--text-muted);
  transition: color var(--duration-fast);

  .theme-option.active &,
  .theme-option:hover & { color: var(--accent-primary); }
}


// ============================================================================
// MEDIA QUERIES — Responsive layout
// ============================================================================

@media (max-width: 991.98px) {
  .main-content {
    margin-left: 0 !important;
  }

  .theme-selector {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (max-width: 767.98px) {
  .glass-header {
    height: 60px;
    padding: 0 var(--space-md, 16px);
  }

  .breadcrumb-nav,
  .content-wrapper {
    padding: var(--space-md, 16px);
  }
}

@media (max-width: 575.98px) {
  .glass-card {
    padding: var(--space-md, 16px);
    border-radius: var(--radius-lg, 20px);
  }

  .theme-selector {
    grid-template-columns: repeat(2, 1fr);
  }

  .toast-container {
    top: var(--space-sm, 12px);
    right: var(--space-sm, 12px);
    left: var(--space-sm, 12px);
  }

  .glass-toast {
    min-width: 0;
    max-width: 100%;
  }
}


// ============================================================================
// REDUCED MOTION — safety override
// ============================================================================

@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration:         0.01ms !important;
    animation-iteration-count:  1      !important;
    transition-duration:        0.01ms !important;
    scroll-behavior: auto !important;
  }

  body::before { animation: none; }
}